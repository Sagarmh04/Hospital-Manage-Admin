generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  role         String   @default("ADMIN")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  sessions Session[]
}

model Session {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  expiresAt DateTime

  ipAddress      String?
  userAgent      String?
  browser        String?
  os             String?
  deviceType     String?
  lastActivityAt DateTime @default(now())

  @@index([userId])
  @@index([expiresAt])
}

model SessionLog {
  id         String    @id @default(uuid())
  sessionId  String
  userId     String
  createdAt  DateTime
  revokedAt  DateTime?
  expiredAt  DateTime?
  ipAddress  String?
  userAgent  String?
  browser    String?
  os         String?
  deviceType String?

  @@index([sessionId])
  @@index([userId])
}

model AuthLog {
  id              String   @id @default(uuid())
  userId          String
  sessionId       String?
  actingSessionId String?
  action          String
  ipAddress       String?
  userAgent       String?
  browser         String?
  os              String?
  deviceType      String?
  timestamp       DateTime @default(now())
  details         Json?

  @@index([userId])
  @@index([sessionId])
  @@index([actingSessionId])
  @@index([action])
}
