// prisma/models/designation.prisma

model Designation {
  id          String   @id @default(uuid())
  name        String   @unique        // "Consultant", "Resident", "Duty Doctor", etc.
  category    String                 // "clinical" | "nursing" | "support" | "admin"
  description String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  permissionGroups DesignationPermissionGroup[]
  workflowFlags    DesignationWorkflowFlag[]
  userAssignments  UserAssignment[]
}

/// Metadata for each workflow flag
model WorkflowFlag {
  id          String           @id @default(uuid())
  code        String           @unique            // e.g. "canBreakGlass"
  description String
  flagType    WorkflowFlagType @default(BOOLEAN)
  enumValues  String[]?

  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  designationMappings DesignationWorkflowFlag[]
  userOverrides       UserWorkflowFlagOverride[]
}

/// Default mapping of Designation -> PermissionGroup (Basic behavior)
model DesignationPermissionGroup {
  id               String            @id @default(uuid())
  designation      Designation       @relation(fields: [designationId], references: [id])
  designationId    String

  group            PermissionGroup   @relation(fields: [permissionGroupId], references: [id])
  permissionGroupId Int

  mode             PermissionGroupMode

  @@unique([designationId, permissionGroupId])
}

/// Default mapping of Designation -> WorkflowFlag (logic layer)
model DesignationWorkflowFlag {
  id            String        @id @default(uuid())
  designation   Designation   @relation(fields: [designationId], references: [id])
  designationId String

  flag          WorkflowFlag  @relation(fields: [flagId], references: [id])
  flagId        String

  valueBool     Boolean?
  valueText     String?
  valueNumber   Float?

  @@unique([designationId, flagId])
}
